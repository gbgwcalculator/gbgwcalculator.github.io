/*
 gbgw-calculator 1.3.3 2021-05-06 
*/

const ActiveWordTagMin=5,MultiplierBuffFull=.1,MultiplierBuffHalf=.05,MultiplierBuffFor=.01,MultiplierBuffMap=.03,MarkWeights=[0,.2,.25,.3,.35,.4,.45],Attributes=["Power","Technique","Speed"],ExTraitType=["EX Skill","Part Traits"],WeaponType=["Beam","Physical"],WeaponSlots=["melee","range"],MainSlot=["head","body","arms","legs","back","melee","range","shield","pilot"],GearSlot=["gear-slot-1","gear-slot-2","gear-slot-3","gear-slot-4","gear-slot-5"],AllSlots=[...MainSlot,...GearSlot],MarksAllowed=["head","body","arms","legs","back","melee","range","shield"],ExCategories=["Beam Shot","Physical Shot","Beam Melee","Physical Melee","Buff","Awakening","Debuff","Recovery"],WordTagData=[{name:"Protag.",parameters:["ma"],multiplier:.1,type:"general"},{name:"Mass P.",parameters:["a"],multiplier:.1,type:"general"},{name:"Ace Excl.",parameters:["sa"],multiplier:.1,type:"general"},{name:"Amphib.",parameters:["br"],multiplier:.1,type:"general"},{name:"Commander",parameters:["sa","br"],multiplier:.05,type:"general"},{name:"Close Combat",parameters:["a","ma"],multiplier:.05,type:"general"},{name:"Mid-Range",parameters:["sa","pr"],multiplier:.05,type:"general"},{name:"Long-Range",parameters:["sa","sd"],multiplier:.05,type:"general"},{name:"High Mobility",parameters:["sd","br"],multiplier:.05,type:"general"},{name:"High Firepower",parameters:["ma","sa"],multiplier:.05,type:"general"},{name:"Heavy Armor",parameters:["md","sd"],multiplier:.05,type:"general"},{name:"Transformer",parameters:["sd"],multiplier:.1,type:"general"},{name:"Gundam Type",parameters:["a","pr"],multiplier:.05,type:"general"},{name:"Mobile Fighter",parameters:["ma","md"],multiplier:.05,type:"general"},{name:"Support Type",parameters:["pr"],multiplier:.1,type:"general"},{name:"Federation",parameters:["ma","sd"],multiplier:.05,type:"general"},{name:"Zeon",parameters:["md"],multiplier:.1,type:"general"},{name:"Zaku Type",parameters:["ma","pr"],multiplier:.05,type:"general"},{name:"GM Type",parameters:["sa","md"],multiplier:.05,type:"general"},{name:"For Space",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Desert",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Tundra",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Forest",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Urban Area",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Base",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"},{name:"For Computers",parameters:["a","ma","sa","md","sd","br","pr"],multiplier:.01,type:"map"}],PilotType=[{name:"All-Rounder"},{name:"Defender",parameters:["a","md","sd"],multiplier:.05},{name:"In-Fighter",parameters:["ma"],multiplier:.1},{name:"Out-Fighter",parameters:["ma"],multiplier:.1},{name:"Middle-Shooter",parameters:["sa"],multiplier:.1},{name:"Long-Shooter",parameters:["sa"],multiplier:.1},{name:"Supporter"}],Sorters=[{key:"rarity",name:"Rarity",slug:"rarity",isParam:!1},{key:"armor",name:"Armor",slug:"a"},{key:"melee-attack",name:"Melee ATK",slug:"ma"},{key:"shot-attack",name:"Shot ATK",slug:"sa"},{key:"melee-defense",name:"Melee DEF",slug:"md"},{key:"shot-defense",name:"Shot DEF",slug:"sd"},{key:"beam-resistance",name:"Beam RES",slug:"br"},{key:"physical-resistance",name:"Phys. RES",slug:"pr"}];let SlotIconMap={head:"slot-head",body:"slot-body",arms:"slot-arms",legs:"slot-legs",back:"slot-back",melee:"short-range-saber",range:"long-range-rifle",shield:"slot-shield",pilot:"slot-pilot","gear-slot-1":"gear-body","gear-slot-2":"gear-arm-right","gear-slot-3":"gear-arm-left","gear-slot-4":"gear-leg-right","gear-slot-5":"gear-leg-left"},SlotTextMap={head:"Head",body:"Body",arms:"Arms",legs:"Legs",back:"Back",melee:"Melee",range:"Range",shield:"Shield",pilot:"Pilot","gear-slot-1":"Torso","gear-slot-2":"R. Arm","gear-slot-3":"L. Arm","gear-slot-4":"R. Leg","gear-slot-5":"L. Leg"},WeaponIconMap={"melee-beam":"skill-beam-melee","melee-physical":"skill-physical-melee","range-beam":"skill-beam-shot","range-physical":"skill-physical-shot"};const triggerEvent=(t,e)=>{var a=document.createEvent("HTMLEvents");a.initEvent(e,!0,!1),t.dispatchEvent(a)};class DataStore{constructor(t){let e=Object.assign({},DataStore.defaultOptions,t);this.url=e.url,this.data=e.data,this.manager=e.manager,this.loaded=!1}setUrl(t){this.url=t}load(){let t=this;fetch(t.url).then(t=>t.json()).then(e=>{t.data=e,t.loaded=!0,t.manager&&t.manager.checkAllLoaded()})}isLoaded(){return this.loaded}getData(){return this.data}}DataStore.defaultOptions={url:"",data:[],manager:null};class DataStoreManager{constructor(){this.stores={},this.allLoadedFn=null}getStore(t){return this.stores[t]}getStoreData(t){return this.getStore(t).getData()}addStore(t,e){this.stores[t]=new DataStore({url:e,manager:this})}addStores(t){let e=this;Object.keys(t).forEach(a=>{e.addStore(a,t[a])})}reloadAllStores(t){this.allLoadedFn=t,Object.values(this.stores).forEach(t=>t.load())}checkAllLoaded(){Object.values(this.stores).every(t=>t.isLoaded())&&this.allLoadedFn&&this.allLoadedFn()}}class GunplaCalculatorUiClass{constructor(t){this.dataStoreManager=t,this.container=document.querySelector(".js-container"),this.container&&this._generateHTML()}_generateHTML(){this._generate()}_createElement(t,e){const a=document.createElement(t.el);"class"in t&&(Array.isArray(t.class)?t.class.forEach(t=>a.classList.add(t)):"string"==typeof t.class&&t.class.split(/\s+/g).forEach(t=>a.classList.add(t))),"text"in t&&(a.textContent=t.text),"html"in t&&(a.innerHTML=t.html),"type"in t&&(a.type=t.type),"readOnly"in t&&(a.readOnly=t.readOnly),"placeholder"in t&&(a.placeholder=t.placeholder),"title"in t&&a.setAttribute("title",t.title),"disabled"in t&&(a.disabled=t.disabled),"hidden"in t&&!0===t.hidden&&(a.style.display="none"),"data"in t&&Array.isArray(t.data)&&t.data.forEach(t=>{a.dataset[t.name]=t.value}),"children"in t&&Array.isArray(t.children)&&t.children.forEach(t=>{this._createElement(t,a)}),e&&e.append&&e.append(a)}_generate(){[this._wordTags(),this._partTrait(),this._info(),this._parts(),this._gears(),this._partList()].forEach(t=>{this._createElement(t,this.container)})}_info(){return{el:"div",class:"info",children:[{el:"h3",text:"Parameters"},...this._paramChildren(),{el:"h3",text:"Active Word Tag"},{el:"div",class:["row","active-word-tag-list","js-active-wt"]},{el:"h3",class:["part-name","js-part-name"]},{el:"h3",text:"Parameters",class:"bg-red"},...this._paramChildren("part"),{el:"h3",text:"Word Tag",class:"bg-red"},{el:"div",class:["row","part-word-tag-list","js-part-wt"]},{el:"h3",text:"Traits / EX Skill",class:"bg-red"},{el:"div",class:["row","part-skill-trait","js-part-skill-trait"]},{el:"button",html:"Equipped<br>Reset",class:"reset-btn"}]}}_paramChildren(t){if(Array.isArray(Sorters)){let e="js-total-",a="alt-bg--blue";return t&&"part"==t&&(e="js-part-total-",a="alt-bg--red"),Sorters.filter(t=>!1!==t.isParam).map(t=>({el:"div",class:["row",a],children:[{el:"div",children:[{el:"label",html:`${this._generateStatIcon(t.key)} ${t.name}`},{el:"span",class:["info__total","float-right",e+t.slug],text:0}]}]}))}}_wordTags(){return{el:"div",class:"word-tags",children:[{el:"h3",text:"Word Tags"},...MainSlot.map(t=>({el:"div",class:["row","height-50","alt-bg"],children:[{el:"span",class:"js-wt-"+t}]}))]}}_partTrait(){return{el:"div",class:"part-trait-ex-skill",children:[{el:"h3",text:"Part Traits / EX Skill"},...MainSlot.map(t=>({el:"div",class:["row","height-50","alt-bg"],children:[{el:"span",class:["part-trait-ex-skill__text","js-skill-trait-"+t]}]}))]}}_parts(){return{el:"div",class:"parts",children:[{el:"h3",text:"Parts"},...this._partsChildren(),this._attributeTally()]}}_gears(){return{el:"div",class:"gears",children:[{el:"h3",text:"Gear"},...this._gearsChildren()]}}_partsChildren(){if(Array.isArray(MainSlot))return MainSlot.map(t=>({el:"div",class:["row","alt-bg","height-50","js-part-cont"],children:[{el:"div",children:[{el:"label",class:["part-slot-type"],html:this._generateSlotIcon(t),title:SlotTextMap[t]},{el:"span",class:["part-slot-attr"]},{el:"input",type:"text",class:"js-input js-input-"+t,data:[{name:"part",value:t}],readOnly:!0}]},{el:"div",children:[{el:"div",class:["weapon-type"],hidden:!WeaponSlots.includes(t)},{el:"div",class:["parts-marks","js-marks-"+t],hidden:"pilot"===t}]}]}))}_gearsChildren(){if(Array.isArray(GearSlot))return GearSlot.map((t,e)=>{let a=this.dataStoreManager.getStoreData("GearTypes"),r=0===Object.values(a)[e].length,s="gear-slot-"+(e+1);return{el:"div",class:["row","alt-bg","height-50","js-part-cont"],children:[{el:"div",children:[{el:"label",class:["part-slot-type"],html:`${this._generateSlotIcon(s)}`,title:SlotTextMap[s]},{el:"input",type:"text",class:"js-input js-input-"+t,readOnly:!0,data:[{name:"part",value:s}],disabled:r}]}]}})}_attributeTally(){return{el:"div",class:"attribute-tally",children:Attributes.map(t=>({el:"label",html:this._generateAttrIcon(t.toLowerCase()),children:[{el:"span",class:"js-tally-"+t.charAt(0).toLowerCase(),text:0}]}))}}_partList(){return{el:"div",class:"part-list",children:[{el:"input",type:"text",placeholder:"Search Part/Pilot",class:["part-list__search","js-search-part"]},{el:"h3",text:"Part List",children:[{el:"span",text:"Remove",class:["part-list__remove","js-remove-part"]}]},{el:"div",class:["part-list__list","js-part-list"]}]}}_generateAttrIcon(t){return`<span class='attr-icon gbgw-attribute-${t}'></span>`}_generateSlotIcon(t){return`<span class='slot-icon gbgw-${SlotIconMap[t]}'></span>`}_generateStatIcon(t){return`<span class='ex-cat-icon gbgw-stat-${t}'></span>`}}class GunplaCalculator{constructor(t){this.dataStoreManager=t,this.wordTagsTally={},this.parametersTotal={},this.attributesTally={p:0,t:0,s:0},this.inputs={},this.comboParts=[],this.parts={},this.partList=document.querySelector(".js-part-list"),this.partNameCont=document.querySelector(".js-part-name"),this.partParamCont={},this.partWTCont=document.querySelector(".js-part-wt"),this.partSkillTraitCont=document.querySelector(".js-part-skill-trait"),this.partCont={},this.filters={attr:"",wt1:"",wt2:"","ex-cat":"","part-trait":"","weapon-type":""},this.applyMapBonus=!1,this.searchPart="",this.sort="",this.currentPart=""}init(){Sorters.filter(t=>!1!==t.isParam).forEach(t=>{this.partParamCont[t.slug]=document.querySelector(".js-part-total-"+t.slug)}),AllSlots.forEach(t=>{this.inputs[t]=document.querySelector(".js-input-"+t),this.parts[t]=[],this.partCont[t]=this.inputs[t].closest(".js-part-cont")}),this._parseParts(),this._sortParts(),this._initInputClick(),this._initFilters(),this._initSort(),this._initApplyMapBonus(),this._initSearchPart(),this._initRemove()}_generateSkillIcon(t){return`<span class='ex-cat-icon gbgw-skill-${t.category.toLowerCase().replace(/\s/g,"-")}'></span>`}_generateAttrIcon(t){return`<span class='attr-icon gbgw-attribute-${t.toLowerCase()}'></span>`}_parseParts(){if(AllSlots&&Array.isArray(AllSlots)){let t=this.dataStoreManager.getStoreData("Collections");t&&Array.isArray(t)&&t.forEach(t=>{if(t.parts&&Array.isArray(t.parts)){const e={ms:t.name,level:t.level};for(let a in t)t.hasOwnProperty(a)&&"parts"!==a&&"name"!==a&&(e[a]=t[a]);t.parts.forEach(t=>{const a=Object.assign({},e);for(let e in t)t.hasOwnProperty(e)&&(a[e]=t[e]);t.part&&this.parts[t.part].push(a)})}});let e=this.dataStoreManager.getStoreData("Pilots");e&&Array.isArray(e)&&e.forEach(t=>{const e={part:"pilot"};for(let a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);this.parts.pilot.push(e)});let a=this.dataStoreManager.getStoreData("GearTypes");a&&"object"==typeof a&&Object.values(a).forEach((t,e)=>{let a="gear-slot-"+(e+1);t.forEach(t=>{const e={part:a};for(let a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);this.parts[a].push(e)})})}}_sortParts(){for(let t in this.parts)switch(t){case"melee":case"range":case"shield":this.parts[t].sort((t,e)=>t.name.localeCompare(e.name)||t.ms.localeCompare(e.ms))}}_initInputClick(){const t=this.inputs;for(let e in t)t.hasOwnProperty(e)&&t[e]&&t[e].addEventListener("click",t=>this._handleInputClick(t.currentTarget))}_handleInputClick(t){const e=t.dataset.part;this.currentPart=e,this._setSelectedPart(e),this._showPartList(e),this._displayPartInfo(t)}_checkFilter(t){this.filters;if(this.filters.attr&&t.attribute&&t.attribute!=this.filters.attr)return!1;if(this.filters.wt1&&t.wt&&t.wt.indexOf(this.filters.wt1)<0)return!1;if(this.filters.wt2&&t.wt&&t.wt.indexOf(this.filters.wt2)<0)return!1;if(this.filters["part-trait"]&&t.ex&&t.ex.name)return new RegExp(this.filters["part-trait"],"i").test(t.ex.name);if(this.filters["ex-cat"]&&t.ex&&!t.jl)return t.ex.category&&t.ex.category===this.filters["ex-cat"];if(this.filters["weapon-type"])switch(t.part){case"melee":case"range":return t.type===this.filters["weapon-type"]}if(this.searchPart.trim().length>0){let e=!!t.ms&&GunplaCalculator.containsNormalized(t.ms,this.searchPart),a=!!t.name&&GunplaCalculator.containsNormalized(t.name,this.searchPart);if(!e&&!a)return!1}return!0}_showPartList(t){let e=this.dataStoreManager.getStoreData("Collections");if(this.partList&&e&&Array.isArray(e)&&(this.partList.innerHTML="",this.parts&&this.parts[t]&&Array.isArray(this.parts[t]))){this._sortPartList([...this.parts[t]]).forEach(t=>{if(!this._checkFilter(t))return;const e=document.createElement("div");e.dataset.partname=this._getDisplayText(t),e.innerHTML=this._renderPartListItem(t),e.classList.add("part-list__item");for(let a in t)e.dataset[a]=t[a]instanceof Object?JSON.stringify(t[a]):t[a];e.addEventListener("click",t=>this._handlePartSelection(t.currentTarget)),e.addEventListener("mouseover",t=>this._displayPartInfo(t.currentTarget)),this.partList.appendChild(e)})}}_sortPartList(t){const e=this.sort,a=-1!==GearSlot.indexOf(t);return e&&(!a||a&&"rarity"===e)&&t.sort((t,a)=>(t[e]||0)>(a[e]||0)?-1:1),t}_renderPartListItem(t){let e=t.attribute?this._generateAttrIcon(t.attribute):"";return e+=this._getDisplayText(t),t.combo&&(e+=`<span class="combo-plus"><span class="gbgw gbgw-slot-${t.combo.type}"></span></span>`),t.level&&(e+=`<span class="part-level" data-level="${t.level}">${t.level}</span>`),e}_getDisplayText(t){return t.jl?`${t.name} (${t.jl.join("/")})`:t.part.startsWith("gear-")||t.ms.startsWith("Unassigned [")?`${t.name}`:t.name?`${t.name} (${t.ms})`:`${t.ms}`}_handlePartSelection(t){let e,a;if(t.dataset.part&&this.inputs[t.dataset.part]){a=t.dataset.part,(e=this.inputs[a]).value=e.title=t.dataset.partname,this._removeAllAttributes(e),Object.assign(e.dataset,t.dataset),this._deleteMarks(a),MarksAllowed.includes(a)&&this._addMarks(),this._displayPartInfo(t);let r=e.dataset.category?e.dataset.category:e.dataset.jl?JSON.parse(e.dataset.jl).join("/"):SlotTextMap[e.dataset.part],s=e.closest(".row");s.querySelector(".part-slot-type").innerHTML=`<span class="slot-icon ${this._getPartSlotClass(t.dataset)}" data-rarity="${t.dataset.rarity}" title="${r}"></span>`;let l=s.querySelector(".part-slot-attr");if(l&&(l.innerHTML=`<span class="gbgw-attribute-${t.dataset.attribute.toLowerCase()}" data-rarity="${t.dataset.rarity}" title="${t.dataset.attribute}"></span>`),WeaponSlots.includes(t.dataset.part)){let e=WeaponIconMap[`${t.dataset.part}-${t.dataset.type.toLowerCase()}`];s.querySelector(".weapon-type").innerHTML=`<span class="gbgw-${e}" data-rarity="${t.dataset.rarity}" title="${t.dataset.type}"></span>`}}this._calculate(a)}_getPartSlotClass(t,e){let a="gbgw-";if(e)a+=SlotIconMap[e];else if(t.category){switch(t.part){case"melee":a+="short-range-";break;case"range":a+="long-range-"}a+=t.category.toLowerCase().replace(/\s/g,"-")}else if(t.jl){const[e]=JSON.parse(t.jl);a+="job-"+e.toLowerCase()}else a+=SlotIconMap[t.part];return a}_setSelectedPart(t){Array.from(document.querySelectorAll(".selected-part")).forEach(t=>{t.classList.remove("selected-part")}),this.partCont[t]&&this.partCont[t].classList.add("selected-part")}_calculate(t){this._toggleComboPart(t),this._displaySkillTraits(t),this._loopThroughInput(),this._displayPartsWordTags()}_toggleComboPart(t){if(this.inputs[t]){const e=this.inputs[t];if(Array.isArray(this.comboParts))for(let t=0;t<this.comboParts.length;t++){const a=this.comboParts[t];if(a.part&&a.combo&&e.dataset.part){if(a.part==e.dataset.part){this._clearComboPart(a.combo,t);break}if(e.dataset.combo){if(JSON.parse(e.dataset.combo).type===a.combo){this._clearParts(a.part),this._clearComboPart(a.combo,t);break}}}}if(e.dataset.combo&&e.dataset.part){const t=e.dataset.rarity,a=JSON.parse(e.dataset.combo);this._clearParts(a.type),this.comboParts.push({part:e.dataset.part,combo:a.type});let r=this.inputs[a.type];r.value=a.name,r.dataset.rarity=t,r.disabled=!0;let s=SlotTextMap[a.type];r.closest(".row").querySelector(".part-slot-type").innerHTML=`<span class="slot-icon ${this._getPartSlotClass(null,a.type)}" data-rarity="${e.dataset.rarity}" title="${s}"></span>`,r.closest(".row").querySelector(".part-slot-attr").innerHTML=`<span class="gbgw-attribute-${e.dataset.attribute.toLowerCase()}" data-rarity="${e.dataset.rarity}" title="${e.dataset.attribute}"></span>`}}}_clearComboPart(t,e){this.inputs[t].disabled=!1,this.comboParts.splice(e,1),this._clearParts(t)}_applyAttributes(t,e){for(let a in e)t.setAttribute(a,e[a]);return t}_removeAttributes(t,e){return e.forEach(e=>t.removeAttribute(e)),t}_displaySkillTraits(t){if(this.inputs[t]){const e=this.inputs[t];let a,r;e&&e.dataset.part&&e.dataset.ex?(r=document.querySelector(".js-skill-trait-"+e.dataset.part),(a=JSON.parse(e.dataset.ex)).type&&a.name&&r&&(r.innerHTML="EX Skill"===a.type?this._generateSkillIcon(a)+a.name+this._appendExStats(a):a.name.replace(/,/,"<br>"),a.description?(this._applyAttributes(r,{"aria-label":"["+a.category+"] "+a.description,"data-balloon-pos":"down","data-balloon-length":"fit"}),r.addEventListener("click",toggleTooltip),r.addEventListener("touchstart",toggleTooltip)):(this._removeAttributes(r,["aria-label","data-balloon-pos","data-balloon-length"]),r.removeEventListener("click",toggleTooltip),r.removeEventListener("touchstart",toggleTooltip)))):this._clearSkillTrait(t)}}_appendExStats(t){if(t.stats){let e=[];return t.stats.Prc&&e.push(`Prc: ${t.stats.Prc}`),t.stats.Pow&&e.push(`Pow: ${t.stats.Pow}`),t.stats.Dur&&e.push(`Dur: ${t.stats.Dur}s`),t.stats.Mag&&e.push(`Mag: ${t.stats.Mag}`),t.stats.Cd&&e.push(`CD: ${t.stats.Cd[0]}s (${t.stats.Cd[1]}s)`),`<div class="ex-stats">${e.map(t=>`<span class="ex-stat">${t}</span>`).join('<span class="ex-stat-spacer"></span>')}</div>`}return""}_clearSkillTrait(t){t&&document.querySelector(".js-skill-trait-"+t)&&(document.querySelector(".js-skill-trait-"+t).textContent="")}_loopThroughInput(){const t=this.inputs;this._resetWordTagTally(),this._resetParameters(),this._resetAttributesTally(),console.log("--------------------");for(let e in t)if(t.hasOwnProperty(e)&&this.inputs[e]){const t=this.inputs[e];t&&(this._tallyWordTags(t),this._calculateParameters(t),this._tallyAttributes(t))}this._displayWordTagsTally(),this._displayParametersTotal(),this._displayAttributesTally()}_resetWordTagTally(){this.wordTagsTally={}}_tallyWordTags(t){if(t&&t.dataset.wt){const e=JSON.parse(t.dataset.wt),a=t.dataset.combo?2:1;Array.isArray(e)&&e.forEach(t=>{this.wordTagsTally[t]=t in this.wordTagsTally?this.wordTagsTally[t]+a:a})}}_displayWordTagsTally(){const t=document.querySelector(".js-active-wt");t.innerHTML="";for(let e in this.wordTagsTally)if(this.wordTagsTally[e]>=ActiveWordTagMin){const a=document.createElement("div");a.textContent=e,t.appendChild(a)}console.log("this.wordTagsTally",this.wordTagsTally)}_resetParameters(){this.parametersTotal={},Sorters.filter(t=>!1!==t.isParam).forEach(t=>{"slug"in t&&(this.parametersTotal[t.slug]=0)})}_calculateParameters(t){if(t&&t.dataset.part){const e=this._getMarkMultiplier(t.dataset.part);Sorters.filter(t=>!1!==t.isParam).forEach(a=>{const r=a.slug;if(r&&t.dataset[r]&&r in this.parametersTotal){let a=t.dataset[r],s=0;isNaN(a)?(a=JSON.parse(a)).attrs&&(s=a.attrs.reduce((t,e)=>t+this.parametersTotal[e],0)*a.multiplier):s=parseInt(a,10);let l=e?s+s*e:s;this.parametersTotal[r]+=Math.floor(l)}})}}_displayParametersTotal(){this._applyWordTagBonus(),this._applyJobLicenseBonus();for(let t in this.parametersTotal)document.querySelector(".js-total-"+t).textContent=this.parametersTotal[t]}_resetAttributesTally(){this.attributesTally={p:0,t:0,s:0}}_tallyAttributes(t){if(t&&t.dataset.attribute&&t.dataset.attribute.charAt(0).toLowerCase()in this.attributesTally){const e=t.dataset.combo?2:1;this.attributesTally[t.dataset.attribute.charAt(0).toLowerCase()]+=e}}_displayAttributesTally(){for(let t in this.attributesTally)document.querySelector(".js-tally-"+t).textContent=this.attributesTally[t]}_applyWordTagBonus(){const t={};console.log("Total Raw Attributes:",this.parametersTotal);let e=0;for(let a in this.wordTagsTally){const r=a;if(this.wordTagsTally[r]>=ActiveWordTagMin){const a=this._getWordTag(r);WordTagData.some(t=>"map"===t.type&&t.name===r)&&e++,a&&a.multiplier&&a.parameters&&Array.isArray(a.parameters)&&a.parameters.forEach(e=>{t[e]=e in t?this._roundValue(t[e]+a.multiplier):a.multiplier})}}e&&this.applyMapBonus&&Array.isArray(Sorters)&&Sorters.filter(t=>!1!==t.isParam).forEach(e=>{t[e.slug]=t[e.slug]?this._roundValue(t[e.slug]+MultiplierBuffMap):MultiplierBuffMap}),console.log("Word Tag Multipliers",t);for(let e in t)e in this.parametersTotal&&(this.parametersTotal[e]=Math.round(this.parametersTotal[e]+this.parametersTotal[e]*t[e]));console.log("Total Attributes With WT Bonus:",this.parametersTotal)}_getWordTag(t){return WordTagData.find(e=>t===e.name)}_applyJobLicenseBonus(){document.querySelector(".js-select-pilot");const t=this.inputs.pilot;if(t&&t.dataset.jl){const e=this._getJobLicense(t.dataset.jl[0]);e&&e.multiplier&&e.parameters&&Array.isArray(e.parameters)&&e.parameters.forEach(t=>{t in this.parametersTotal&&(this.parametersTotal[t]=Math.round(this.parametersTotal[t]+this.parametersTotal[t]*e.multiplier))})}console.log("Total Attributes With WT Bonus and Job Bonus:",this.parametersTotal)}_getJobLicense(t){return PilotType.find(e=>t===e.name)}_displayPartsWordTags(){const t=this.inputs;for(let e in t)if(t.hasOwnProperty(e)){const a=this.inputs[e];a&&(this._displayWordTags(a)||!1!==t[e].disabled||this._clearWordTag(e))}}_clearWordTag(t){let e=document.querySelector(".js-wt-"+t);e&&(e.innerHTML="")}_clearParts(t){if(t&&t in this.inputs){const e=this.inputs[t];e.value="",e.title="",this._removeAllAttributes(e),Object.assign(e.dataset,document.createElement("input").dataset),this._clearSkillTrait(t),this._clearWordTag(t),this._deleteMarks(t);let a=e.closest(".row"),r=a.querySelector(".part-slot-type").querySelector(".slot-icon");r.className=`slot-icon gbgw-${SlotIconMap[t]}`,r.removeAttribute("data-rarity"),r.setAttribute("title",SlotTextMap[t]);let s=a.querySelector(".part-slot-attr");s&&(s.innerHTML="");let l=a.querySelector(".weapon-type");l&&(l.innerHTML="")}}_populateFilter(t,e){"string"==typeof t&&(t=document.querySelector(t)),Array.isArray(e)&&e.forEach(e=>t.appendChild(new Option(e,e)))}_initFilters(){let t=WordTagData.map(t=>t.name).sort();this._populateFilter(".js-filter-attr",Attributes),this._populateFilter(".js-filter-wt1",t),this._populateFilter(".js-filter-wt2",t),this._populateFilter(".js-filter-ex-cat",ExCategories),this._populateFilter(".js-filter-part-trait",this.dataStoreManager.getStoreData("TraitDescriptions")),this._populateFilter(".js-filter-weapon-type",WeaponType);for(let t in this.filters){const e=t;this.filters.hasOwnProperty(e)&&document.querySelector(".js-filter-"+e).addEventListener("change",t=>{let a=t.currentTarget,r=a.value;a.classList.toggle("unselected-filter",""===r),this.filters[e]=r,this.currentPart&&this._showPartList(this.currentPart)})}}_initSort(){const t=document.querySelector(".js-sort-param");Array.isArray(Sorters)&&(Sorters.forEach(e=>{const a=document.createElement("option");a.value=e.slug,a.text=e.name,t.appendChild(a)}),t.addEventListener("change",t=>{this.sort=t.currentTarget.value,this.currentPart&&this._showPartList(this.currentPart)}))}_initApplyMapBonus(){const t=document.querySelector(".js-apply-map-bonus");t.checked=!1,t.addEventListener("change",t=>{this.applyMapBonus=t.currentTarget.checked,this._loopThroughInput()})}_initSearchPart(){let t;document.querySelector(".js-search-part").addEventListener("keyup",e=>{this.searchPart=e.currentTarget.value,clearTimeout(t),t=setTimeout(()=>{this.currentPart&&this._showPartList(this.currentPart)},500)})}_clearPartBySlot(t,e){if(t&&Array.isArray(AllSlots)&&AllSlots.indexOf(t)>-1){const a=document.querySelector(".js-input-"+t);if(a&&a.dataset.combo){const e=JSON.parse(a.dataset.combo);document.querySelector(".js-input-"+e.type).disabled=!1;let r=this.comboParts.find(e=>e.part===t);r&&this._clearComboPart(r.combo,this.comboParts.indexOf(r))}this._clearParts(t),e&&(this._loopThroughInput(),this._displayPartsWordTags())}}_initRemove(){document.querySelector(".js-remove-part").addEventListener("click",t=>{this._clearPartBySlot(this.currentPart,!0)}),document.querySelector(".reset-btn").addEventListener("click",t=>{let e=Object.keys(this.inputs);e.forEach((t,a)=>{this._clearPartBySlot(t,a===e.length-1)})})}_displayPartInfo(t){if(t&&t.dataset.partname&&MainSlot.indexOf(t.dataset.part)>-1){const e=JSON.parse(t.dataset.wt),a=JSON.parse(t.dataset.ex);let r=0;this.partNameCont.textContent=t.dataset.partname?t.dataset.partname:"","input"===t.nodeName.toLowerCase()&&(r=this._getMarkMultiplier(t.dataset.part)),Sorters.filter(t=>!1!==t.isParam).filter(t=>!1!==t.isParam).forEach(e=>{let a=+t.dataset[e.slug];this.partParamCont[e.slug].textContent=0,a&&(this.partParamCont[e.slug].textContent=r?a+Math.floor(a*r):a)}),Array.isArray(e)?this.partWTCont.innerHTML=e.reduce((t,e)=>t+"<div>"+e+"</div>",""):this.partWTCont.innerHTML="",this.partSkillTraitCont.innerHTML=a.type&&a.name?"EX Skill"===a.type?`<span>${this._generateSkillIcon(a)+a.name}</span>`+this._appendExStats(a):a.name:""}}_createMark(t,e){if(t&&t.append&&e){const a=document.createElement("div"),r=document.querySelector(".js-input-"+e);a.classList.add("parts-marks__item"),a.classList.add("js-mark-item"),a.dataset.value="0",a.addEventListener("click",t=>{this._updateMark(t.currentTarget),this._setSelectedPart(e),this._displayPartInfo(r),this._loopThroughInput()}),t.append(a)}}_updateMark(t){let e=parseInt(t.dataset.value,10),a=0===e?6:e-1;t.dataset.value=a.toString(10)}_deleteMarks(t){const e=document.querySelector(".js-marks-"+t);e&&e.innerHTML&&(e.innerHTML="")}_calculateMarkCount(t){return parseInt(t.dataset.mark?t.dataset.mark:6-t.dataset.rarity,10)}_addMarks(){const t=this.currentPart,e=document.querySelector(".js-marks-"+t),a=e?document.querySelector(".js-input-"+t):null,r=this._calculateMarkCount(a);if(r)for(let a=0;a<r;a++)this._createMark(e,t)}_getMarkMultiplier(t){let e=0;return Array.from(document.querySelectorAll(".js-marks-"+t+" .js-mark-item")).forEach(t=>{t.dataset.value&&(e=this._roundValue(e+MarkWeights[t.dataset.value]))}),e}_hasComboParts(t){const e=document.querySelector(".js-input-"+t);return!(!e||!e.dataset.combo)}_hasSelectedPart(t){const e=document.querySelector(".js-input-"+t);return!!(e&&e.value.length>0)}_displayWordTags(t){if(!(t&&t.dataset.part&&t.dataset.wt))return!1;const e=document.querySelector(".js-wt-"+t.dataset.part),a=JSON.parse(t.dataset.wt);if(Array.isArray(a)&&e&&(e.innerHTML=a.reduce((t,e)=>{const a=this.wordTagsTally[e];return t+(""==t?"":"<br />")+'<span class="'+(a>=ActiveWordTagMin?"activated-wt":"")+'">('+a+") "+e+"</span>"},""),t.dataset.combo)){const a=JSON.parse(t.dataset.combo);document.querySelector(".js-wt-"+a.type).innerHTML=e.innerHTML}return!0}_formatDataTag(t){return t.replace(/([A-Z])/g,t=>"-"+t[0].toLowerCase())}_removeAllAttributes(t){if(t.dataset)for(let e in t.dataset)"part"!==e&&t.removeAttribute("data-"+this._formatDataTag(e))}_roundValue(t){return Math.round(1e12*t)/1e12}}GunplaCalculator.greekDict={"Α":{upper:"Α",lower:"α",name:"alpha",romanized:"a"},"Β":{upper:"Β",lower:"β",name:"beta",romanized:"b"},"Γ":{upper:"Γ",lower:"γ",name:"gamma",romanized:"g"},"Δ":{upper:"Δ",lower:"δ",name:"delta",romanized:"d"},"Ε":{upper:"Ε",lower:"ε",name:"epsilon",romanized:"e"},"Ζ":{upper:"Ζ",lower:"ζ",name:"zeta",romanized:"z"},"Η":{upper:"Η",lower:"η",name:"eta",romanized:"h"},"Θ":{upper:"Θ",lower:"θ",name:"theta",romanized:"th"},"Ι":{upper:"Ι",lower:"ι",name:"iota",romanized:"i"},"Κ":{upper:"Κ",lower:"κ",name:"kappa",romanized:"k"},"Λ":{upper:"Λ",lower:"λ",name:"lambda",romanized:"l"},"Μ":{upper:"Μ",lower:"μ",name:"mu",romanized:"m"},"Ν":{upper:"Ν",lower:"ν",name:"nu",romanized:"n"},"Ξ":{upper:"Ξ",lower:"ξ",name:"xi",romanized:"x"},"Ο":{upper:"Ο",lower:"ο",name:"omicron",romanized:"o"},"Π":{upper:"Π",lower:"π",name:"pi",romanized:"p"},"Ρ":{upper:"Ρ",lower:"ρ",name:"rho",romanized:"r"},"Σ":{upper:"Σ",lower:"σ",name:"sigma",romanized:"s",alt:"ς"},"Τ":{upper:"Τ",lower:"τ",name:"tau",romanized:"t"},"Υ":{upper:"Υ",lower:"υ",name:"upsilon",romanized:"u"},"Φ":{upper:"Φ",lower:"φ",name:"phi",romanized:"ph"},"Χ":{upper:"Χ",lower:"χ",name:"chi",romanized:"ch"},"Ψ":{upper:"Ψ",lower:"ψ",name:"psi",romanized:"ps"},"Ω":{upper:"Ω",lower:"ω",name:"omega",romanized:"o"}},GunplaCalculator.greekPattern=new RegExp(`[${Object.keys(GunplaCalculator.greekDict).join("")}]`,"i"),GunplaCalculator.replaceGreek=(t=>GunplaCalculator.greekDict[t.toUpperCase()].name),GunplaCalculator.normalizeString=(t=>t.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(GunplaCalculator.greekPattern,GunplaCalculator.replaceGreek).replace(/[\s.-]/g,"")),GunplaCalculator.containsNormalized=((t,e)=>-1!==GunplaCalculator.normalizeString(t).indexOf(GunplaCalculator.normalizeString(e)));const BASE_DATA_DIR="dist/data",dataStoreManager=new DataStoreManager;function onAllStoresLoaded(){main()}function main(){new GunplaCalculatorUiClass(dataStoreManager),new GunplaCalculator(dataStoreManager).init(),toggleTheme(),resize()}function resize(){const t=document.querySelector(".container");t.offsetWidth<1500&&(document.querySelector(".app").style.minWidth=`calc(${t.offsetWidth}px + 1em)`)}function toggleTheme(){const t=document.querySelector('.theme-switch input[type="checkbox"]');t.addEventListener("change",function(t){let e=t.target.checked;document.documentElement.setAttribute("data-theme",e?"dark":"light"),localStorage.setItem("theme",e?"dark":"light")},!1);const e=localStorage.getItem("theme")?localStorage.getItem("theme"):null;e&&(document.documentElement.setAttribute("data-theme",e),"dark"===e&&(t.checked=!0))}function toggleTooltip(t){let e=t.currentTarget;e.getAttribute("data-balloon-visible")?e.removeAttribute("data-balloon-visible"):(e.setAttribute("data-balloon-visible",!0),setTimeout(()=>{e.getAttribute("data-balloon-visible")&&e.removeAttribute("data-balloon-visible")},5e3)),document.querySelector(".part-list").focus()}dataStoreManager.addStores({Collections:"dist/data/gunpla.json",GearTypes:"dist/data/gears.json",Pilots:"dist/data/pilots.json",TraitDescriptions:"dist/data/traits.json"}),dataStoreManager.reloadAllStores(onAllStoresLoaded);
//# sourceMappingURL=bundle.min.js.map